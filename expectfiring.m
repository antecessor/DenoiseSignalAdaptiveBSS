function [e,newM] = expectfiring (M,fs)% Estimates the expected firing times for the bar display.t0=0;t1=max(M)*fs;	e = [];		[Sp_Flag,meanisi,sd,pd,nI]=Main_Firing_Analysis_1(M/fs);	tmid = (t0+t1) / 2;	%nearpat = fullpat (fullpat > tmid-1 & fullpat < tmid+1);		% fullpat is the figing times of the unit    fullpat=M/fs;	pat = fullpat (fullpat > t0-2*meanisi & fullpat < t1+2*meanisi);			lmm = pat - 1.5*meanisi;	lm  = pat - 1.3*meanisi;	l   = pat - 1.2*meanisi;	lp  = pat - 1.1*meanisi;	lpp = pat - 0.9*meanisi;		rmm = pat + 0.9*meanisi;	rm  = pat + 1.1*meanisi;	r   = pat + 1.2*meanisi;	rp  = pat + 1.4*meanisi;	rpp = pat + 1.6*meanisi;		ie = 0;	for i=1:length(pat);		[b,k] = min(abs(r - l(i)));		if lpp(i) > rmm(k) & lmm(i) < rpp(k);			ie = ie + 1;			e(ie,:) = [min(lm(i),rm(k)), max(lp(i),rp(k))];		else			ie = ie + 1;			e(ie,:) = [lm(i), lp(i)];		end;		[b,k] = min(abs(r(i) - l(:)));		if lpp(k) > rmm(i) & lmm(k) < rpp(i);		else			ie = ie + 1;			e(ie,:) = [rm(i), rp(i)];		end;	end;%% Remove e=round(e*fs);newM=[];for i=1:size(e,1)    MM=M(M>=e(i,1));    newM=[newM MM(MM<=e(i,2))];end    end